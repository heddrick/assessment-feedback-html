<!DOCTYPE html>
<html>
<head>
  <title>UNC SON PASS Assesment Feedback Tool</title>
</head>
<body onload="pulse()">
  <center>
  <h1>UNC SON PASS Assessment Feedback Tool</h1>
  <form>
    <label for="prompt">Assessment:</label>
    <br />
    <textarea id="prompt" rows="5" cols="50"></textarea>
    <br />
    <button id="button" type="button" onclick="generate()">Get Feedback</button>
  </form>
  <br />
  <label for="response">Feedback:</label>
  <br />
  <textarea id="response" rows="10" cols="50" readonly></textarea>
  </center>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    const pulseUrl = 'https://assessment-feedback-backend-dept-son-passtool.apps.cloudapps.unc.edu:8090/api/pulse'

    const pulse = async () => {
      const promptElem   = document.getElementById('prompt'  );
      const responseElem = document.getElementById('response');
      const generateElem = document.getElementById('button'  );
      
      responseElem.value = 'Checking that the server is online...';

      try {
        const response = await axios.get(pulseUrl, {
          headers: {
            'Content-Type': 'application/json',
          }
        });

        const pulseResult = response.data.result;
        responseElem.value = '';

      } catch (error) {
        console.error(error);
        promptElem  .disabled = true;
        generateElem.disabled = true;
        responseElem.value  = 'The server is down.';
      }
    }
    
    const promptUrl  = 'https://assessment-feedback-backend-dept-son-passtool.apps.cloudapps.unc.edu:8090/api/prompt'

    const generate = async () => {
      const promptValue  = document.getElementById('prompt'  ).value;
      const responseElem = document.getElementById('response');

      responseElem.value = 'Generating...';

      try {
        const response = await axios.post(promptUrl, {
          prompt: promptValue
        }, {
          headers: {
            'Content-Type': 'application/json',
          }
        });

        const generateResult = response.data.result;
        responseElem.value = generateResult;

      } catch (error) {
        console.error(error);
        responseElem.value = error.response.data.result.error.message;
      }
    }
  </script>
</body>
</html>



